/**
 * å•æ‰‹äº¤æ˜“ç­–ç•¥æç¤ºè¯
 * ç”¨äºAIåˆ†æå•æ‰‹äº¤æ˜“å†³ç­–
 */

import type { KlineData, DepthData, SingleHandPosition, SingleHandOperation } from '../types';

export interface BollingerBands {
  upper: number | null;
  middle: number | null;
  lower: number | null;
}

export interface SingleHandPromptParams {
  londonKline1m: KlineData[];
  londonKline15m: KlineData[];
  londonKline1d: KlineData[];
  domesticKline1m: KlineData[];
  domesticKline15m: KlineData[];
  domesticKline1d: KlineData[];
  domesticDepth: DepthData | null;
  currentPosition: SingleHandPosition;
  recentOperations: SingleHandOperation[];  // æœ€è¿‘10æ¡æ“ä½œè®°å½•
  currentPrice: number;  // å½“å‰ä»·æ ¼
  domesticBollinger1m?: BollingerBands;  // å›½å†…1åˆ†é’Ÿå¸ƒæ—å¸¦
  domesticBollinger15m?: BollingerBands;  // å›½å†…15åˆ†é’Ÿå¸ƒæ—å¸¦
}

/**
 * æ„å»ºå•æ‰‹äº¤æ˜“ç­–ç•¥æç¤ºè¯æ¶ˆæ¯æ•°ç»„
 */
export function buildSingleHandMessages(params: SingleHandPromptParams): Array<{role: string, content: string}> {
  const {
    londonKline1m,
    londonKline15m,
    londonKline1d,
    domesticKline1m,
    domesticKline15m,
    domesticKline1d,
    domesticDepth,
    currentPosition,
    recentOperations,
    currentPrice,
    domesticBollinger1m,
    domesticBollinger15m,
  } = params;

  // æ ¼å¼åŒ–Kçº¿æ•°æ®ï¼ˆåˆ†é’Ÿçº§åˆ«ï¼‰
  const formatKlineData = (klines: KlineData[], count: number = 20) => {
    return klines.slice(-count).map(k => {
      const time = new Date(k.t).toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
      const volume = k.v !== undefined ? ` é‡${k.v >= 10000 ? (k.v / 10000).toFixed(1) + 'w' : k.v.toFixed(0)}` : '';
      return `${time}: å¼€${k.o.toFixed(2)}/é«˜${k.h.toFixed(2)}/ä½${k.l.toFixed(2)}/æ”¶${k.c.toFixed(2)}${volume}`;
    }).join('\n');
  };

  // æ ¼å¼åŒ–Kçº¿æ•°æ®ï¼ˆæ—¥çº¿çº§åˆ«ï¼‰
  const formatKlineDataDaily = (klines: KlineData[], count: number = 50) => {
    return klines.slice(-count).map(k => {
      const date = new Date(k.t).toLocaleDateString('zh-CN', { month: '2-digit', day: '2-digit' });
      const volume = k.v !== undefined ? ` é‡${k.v >= 10000 ? (k.v / 10000).toFixed(1) + 'w' : k.v.toFixed(0)}` : '';
      return `${date}: å¼€${k.o.toFixed(2)}/é«˜${k.h.toFixed(2)}/ä½${k.l.toFixed(2)}/æ”¶${k.c.toFixed(2)}${volume}`;
    }).join('\n');
  };

  // æ ¼å¼åŒ–ç›˜å£æ•°æ®
  const formatDepthData = (depth: DepthData | null) => {
    if (!depth) return 'ç›˜å£æ•°æ®ä¸å¯ç”¨';
    
    const asks = depth.ask_price.slice(0, 5).map((price, idx) => 
      `å–${5-idx}: ${price} (${depth.ask_volume[idx]})`
    ).reverse().join('\n');
    
    const bids = depth.bid_price.slice(0, 5).map((price, idx) => 
      `ä¹°${idx+1}: ${price} (${depth.bid_volume[idx]})`
    ).join('\n');
    
    // æ ¼å¼åŒ–æ¶¨è·Œæ•°æ®
    const priceInfo = depth.last_price ? `å½“å‰ä»·: ${depth.last_price}` : '';
    const changeInfo = depth.change && depth.change_percent 
      ? `  æ¶¨è·Œ: ${depth.change} (${depth.change_percent}%)`
      : '';
    
    // æ ¼å¼åŒ–æˆäº¤å’ŒæŒä»“æ•°æ®
    const volumeInfo = depth.volume ? `æˆäº¤é‡: ${depth.volume}` : '';
    const openInterestInfo = depth.open_interest ? `  æŒä»“é‡: ${depth.open_interest}` : '';
    const openInterestChange = depth.open_interest && depth.pre_open_interest
      ? `  æŒä»“å·®: ${(Number(depth.open_interest) - Number(depth.pre_open_interest)).toFixed(0)}`
      : '';
    
    // æ ¼å¼åŒ–ä»·æ ¼åŒºé—´
    const priceRangeInfo = depth.open && depth.highest && depth.lowest
      ? `å¼€ç›˜: ${depth.open}  æœ€é«˜: ${depth.highest}  æœ€ä½: ${depth.lowest}`
      : '';
    
    return `${asks}
${priceInfo}${changeInfo}
${bids}

${priceRangeInfo}
${volumeInfo}${openInterestInfo}${openInterestChange}`;
  };

  // æ ¼å¼åŒ–å½“å‰æŒä»“
  const formatPosition = (position: SingleHandPosition) => {
    if (!position.hasPosition) {
      return 'å½“å‰æ— æŒä»“ï¼Œå¯ä»¥å¼€ä»“';
    }
    
    const duration = position.entryTime 
      ? Math.round((Date.now() - position.entryTime) / 60000) 
      : 0;
    
    return `å½“å‰æŒä»“: ${position.direction}å•
å…¥åœºä»·: ${position.entryPrice?.toFixed(0)}
å…¥åœºæ—¶é—´: ${position.entryTime ? new Date(position.entryTime).toLocaleTimeString('zh-CN') : 'æœªçŸ¥'}
æŒä»“æ—¶é•¿: ${duration}åˆ†é’Ÿ
å½“å‰ä»·æ ¼: ${position.currentPrice?.toFixed(0)}
ç›ˆäºç‚¹æ•°: ${position.profitLossPoints?.toFixed(0)}ç‚¹
ç›ˆäºé‡‘é¢: ${position.profitLossMoney?.toFixed(0)}å…ƒ (æ¯ç‚¹15å…ƒ)
æœ€é«˜ç›ˆåˆ©: ${position.maxProfitPoints?.toFixed(0)}ç‚¹ (${position.maxProfitMoney?.toFixed(0)}å…ƒ)
å›æ’¤æ¯”ä¾‹: ${position.drawdownPercent?.toFixed(1)}% (ä»æœ€é«˜ç‚¹å›æ’¤)`;
  };

  // æ ¼å¼åŒ–æ“ä½œå†å²å¹¶åˆ†æç»©æ•ˆ
  const formatOperations = (operations: SingleHandOperation[]) => {
    if (operations.length === 0) {
      return 'æš‚æ— å†å²æ“ä½œè®°å½•';
    }
    
    // ç»Ÿè®¡ç»©æ•ˆ
    const closedOps = operations.filter(op => op.action === 'å¹³ä»“' && op.netProfit !== undefined);
    const winOps = closedOps.filter(op => (op.netProfit || 0) > 0);
    const lossOps = closedOps.filter(op => (op.netProfit || 0) < 0);
    const winRate = closedOps.length > 0 ? (winOps.length / closedOps.length * 100).toFixed(0) : '0';
    const totalProfit = closedOps.reduce((sum, op) => sum + (op.netProfit || 0), 0);
    
    // æœ€è¿‘3æ¬¡æ“ä½œçš„è¶‹åŠ¿
    const recent3 = operations.slice(0, 3);
    const recent3Loss = recent3.filter(op => 
      op.action === 'å¹³ä»“' && op.netProfit !== undefined && op.netProfit < 0
    ).length;
    
    const performanceSummary = `
ã€ç»©æ•ˆç»Ÿè®¡ã€‘
- èƒœç‡: ${winRate}% (${winOps.length}èƒœ/${lossOps.length}è´¥ï¼Œå…±${closedOps.length}æ¬¡å¹³ä»“)
- ç´¯è®¡å‡€åˆ©æ¶¦: ${totalProfit > 0 ? '+' : ''}${totalProfit.toFixed(0)}å…ƒ
- æœ€è¿‘3æ¬¡æ“ä½œ: ${recent3Loss >= 2 ? 'âš ï¸ è¿ç»­äºæŸï¼éœ€è¦åæ€ç­–ç•¥ï¼' : recent3Loss === 1 ? 'æœ‰äºæŸï¼Œéœ€è­¦æƒ•' : 'è¡¨ç°æ­£å¸¸'}
`;
    
    const opsList = operations.map((op, idx) => {
      const opDate = new Date(op.timestamp);
      // æ ¼å¼åŒ–æ—¶é—´ï¼šåŒ…å«æ—¥æœŸå’Œæ—¶é—´ï¼Œæ ¼å¼å¦‚ "11æœˆ12æ—¥ 09:28:13"
      // ç¡®ä¿æ—¶é—´æˆ³æ­£ç¡®è§£æ
      if (isNaN(opDate.getTime())) {
        console.warn(`[æ ¼å¼åŒ–æ“ä½œè®°å½•] æ— æ•ˆçš„æ—¶é—´æˆ³: ${op.timestamp}`);
        return `${idx+1}. [æ—¶é—´æ— æ•ˆ] ${op.action} @ ${op.price.toFixed(0)}`;
      }
      
      const month = opDate.getMonth() + 1;
      const day = opDate.getDate();
      const hours = opDate.getHours().toString().padStart(2, '0');
      const minutes = opDate.getMinutes().toString().padStart(2, '0');
      const seconds = opDate.getSeconds().toString().padStart(2, '0');
      const fullTime = `${month}æœˆ${day}æ—¥ ${hours}:${minutes}:${seconds}`;
      
      const profitInfo = op.profitLossPoints !== undefined 
        ? ` | ç›ˆäº: ${op.profitLossPoints.toFixed(0)}ç‚¹ (${op.profitLossMoney?.toFixed(0)}å…ƒ)`
        : '';
      const netProfitInfo = op.netProfit !== undefined 
        ? ` | å‡€åˆ©æ¶¦: ${op.netProfit > 0 ? '+' : ''}${op.netProfit.toFixed(0)}å…ƒ`
        : '';
      const reflectionInfo = op.reflection 
        ? `\n   ğŸ¤” AIåæ€: ${op.reflection}`
        : '';
      return `${idx+1}. [${fullTime}] ${op.action} @ ${op.price.toFixed(0)}${profitInfo}${netProfitInfo}\n   åŸå› : ${op.reason}${reflectionInfo}`;
    }).join('\n\n');
    
    return `${performanceSummary}\nã€æ“ä½œè®°å½•ã€‘\n${opsList}`;
  };

  // æ ¼å¼åŒ–å¸ƒæ—å¸¦æ•°æ®
  const formatBollinger = (bollinger?: BollingerBands, label: string = '') => {
    if (!bollinger || bollinger.upper === null || bollinger.middle === null || bollinger.lower === null) {
      return `${label}å¸ƒæ—å¸¦ï¼šæ•°æ®ä¸å¯ç”¨`;
    }
    return `${label}å¸ƒæ—å¸¦ï¼šä¸Šè½¨${bollinger.upper.toFixed(0)} | ä¸­è½¨${bollinger.middle.toFixed(0)} | ä¸‹è½¨${bollinger.lower.toFixed(0)}`;
  };

  // è·å–å½“å‰æ—¶é—´
  const now = new Date();
  const currentTimeStr = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
  const hours = now.getHours();
  const minutes = now.getMinutes();
  
  // æ£€æŸ¥æ˜¯å¦æ¥è¿‘æ”¶ç›˜ï¼ˆæ”¶ç›˜å‰1åˆ†é’Ÿï¼‰
  const isNearClose = 
    (hours === 10 && minutes === 14) ||  // 10:14åˆ†ï¼ˆ10:15æ”¶ç›˜å‰ï¼‰
    (hours === 11 && minutes === 29) ||  // 11:29åˆ†ï¼ˆ11:30æ”¶ç›˜å‰ï¼‰
    (hours === 14 && minutes === 59) ||  // 14:59åˆ†ï¼ˆ15:00æ”¶ç›˜å‰ï¼‰
    (hours === 2 && minutes === 29);     // æ¬¡æ—¥2:29åˆ†ï¼ˆ2:30æ”¶ç›˜å‰ï¼‰
  
  const closeWarning = isNearClose && currentPosition.hasPosition
    ? '\n\nâš ï¸âš ï¸âš ï¸ è­¦å‘Šï¼šå½“å‰æ—¶é—´æ¥è¿‘æ”¶ç›˜ï¼ˆæ”¶ç›˜å‰1åˆ†é’Ÿï¼‰ï¼Œå¿…é¡»ç«‹å³å¹³ä»“ï¼ä¸è¦æŒä»“åˆ°æ”¶ç›˜ï¼ âš ï¸âš ï¸âš ï¸'
    : '';

  // æ¯ä¸ªæ•°æ®é¡¹éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„user message
  const messages = [
    {
      role: 'user',
      content: `å½“å‰æ—¶é—´å’Œä»·æ ¼\nå½“å‰æ—¶é—´: ${currentTimeStr}${closeWarning}\nå›½å†…ç™½é“¶ä¸»åŠ›å½“å‰ä»·: ${currentPrice.toFixed(0)}`
    },
    {
      role: 'user',
      content: `ä¼¦æ•¦ç°è´§ç™½é“¶ (1åˆ†é’ŸKçº¿ï¼Œæœ€è¿‘100æ ¹)\n${formatKlineData(londonKline1m, 100)}`
    },
    {
      role: 'user',
      content: `ä¼¦æ•¦ç°è´§ç™½é“¶ (15åˆ†é’ŸKçº¿ï¼Œæœ€è¿‘50æ ¹)\n${formatKlineData(londonKline15m, 50)}`
    },
    {
      role: 'user',
      content: `ä¼¦æ•¦ç°è´§ç™½é“¶ (æ—¥çº¿ï¼Œæœ€è¿‘50æ ¹)\n${formatKlineDataDaily(londonKline1d, 50)}`
    },
    {
      role: 'user',
      content: `å›½å†…ç™½é“¶ä¸»åŠ› (1åˆ†é’ŸKçº¿ï¼Œæœ€è¿‘100æ ¹)\n${formatKlineData(domesticKline1m, 100)}`
    },
    {
      role: 'user',
      content: `å›½å†…ç™½é“¶ä¸»åŠ› (15åˆ†é’ŸKçº¿ï¼Œæœ€è¿‘50æ ¹)\n${formatKlineData(domesticKline15m, 50)}`
    },
    {
      role: 'user',
      content: `å›½å†…ç™½é“¶ä¸»åŠ› (æ—¥çº¿ï¼Œæœ€è¿‘50æ ¹)\n${formatKlineDataDaily(domesticKline1d, 50)}`
    },
    {
      role: 'user',
      content: `å›½å†…ç™½é“¶ç›˜å£\n${formatDepthData(domesticDepth)}`
    },
    {
      role: 'user',
      content: `æŠ€æœ¯æŒ‡æ ‡\n${formatBollinger(domesticBollinger1m, '1åˆ†é’Ÿ')}\n${formatBollinger(domesticBollinger15m, '15åˆ†é’Ÿ')}`
    },
    {
      role: 'user',
      content: `å½“å‰æŒä»“çŠ¶æ€\n${formatPosition(currentPosition)}`
    },
    {
      role: 'user',
      content: `æœ€è¿‘10æ¡æ“ä½œè®°å½•\n${formatOperations(recentOperations)}`
    }
  ];

  // æœ€åä¸€ä¸ªuser messageï¼šåˆ†æè¦æ±‚
  const analysisMessage = {
    role: 'user',
    content: `åˆ†æè¦æ±‚

è¯·åŸºäºä»¥ä¸Šå¸‚åœºæ•°æ®å’ŒæŒä»“çŠ¶æ€ï¼Œç»™å‡ºä½ çš„äº¤æ˜“å†³ç­–ã€‚

**âš ï¸ æœ€é«˜ä¼˜å…ˆçº§ï¼šæ”¶ç›˜å‰å¼ºåˆ¶å¹³ä»“**ï¼š
å¦‚æœå½“å‰æœ‰æŒä»“ï¼Œæ£€æŸ¥å½“å‰æ—¶é—´æ˜¯å¦æ¥è¿‘æ”¶ç›˜ï¼š
- **10:14åˆ†**ï¼ˆ10:15æ”¶ç›˜å‰ï¼‰â†’ **ç«‹å³å¹³ä»“ï¼**
- **11:29åˆ†**ï¼ˆ11:30æ”¶ç›˜å‰ï¼‰â†’ **ç«‹å³å¹³ä»“ï¼**
- **14:59åˆ†**ï¼ˆ15:00æ”¶ç›˜å‰ï¼‰â†’ **ç«‹å³å¹³ä»“ï¼**
- **æ¬¡æ—¥2:29åˆ†**ï¼ˆ2:30æ”¶ç›˜å‰ï¼‰â†’ **ç«‹å³å¹³ä»“ï¼**
**æ”¶ç›˜å‰1åˆ†é’Ÿå¿…é¡»æ¸…ä»“ï¼Œæ— è®ºç›ˆäºï¼ä¸è¦æŒä»“åˆ°æ”¶ç›˜ï¼**

**âš ï¸ é¦–è¦ä»»åŠ¡ï¼šåæ€å†å²ç»©æ•ˆ**ï¼š
1. **æŸ¥çœ‹ç»©æ•ˆç»Ÿè®¡**ï¼šèƒœç‡<50%è¯´æ˜ç­–ç•¥æœ‰é—®é¢˜ï¼Œå¿…é¡»åæ€ï¼
2. **è¿ç»­äºæŸè­¦ç¤º**ï¼šæœ€è¿‘3æ¬¡æ“ä½œå¦‚æœæœ‰2æ¬¡ä»¥ä¸ŠäºæŸï¼Œè¯´æ˜æ–¹å‘åˆ¤æ–­é”™è¯¯ï¼
   - **ç«‹å³åœæ­¢é‡å¤é”™è¯¯**ï¼šä¸è¦å†ç”¨ç›¸åŒçš„é€»è¾‘åšç›¸åŒæ–¹å‘ï¼
   - **è€ƒè™‘åå‘æ“ä½œ**ï¼šå¸‚åœºå¯èƒ½åœ¨å‘Šè¯‰ä½ åå‘æ‰å¯¹
   - **é™ä½é¢‘ç‡**ï¼šè¿ç»­äºæŸæ—¶è¦æ›´è°¨æ…ï¼Œç­‰å¾…æ›´æ˜ç¡®çš„ä¿¡å·
3. **ç´¯è®¡äºæŸè­¦ç¤º**ï¼šå‡€åˆ©æ¶¦ä¸ºè´Ÿè¯´æ˜æ•´ä½“ç­–ç•¥å¤±è´¥ï¼Œå¿…é¡»è°ƒæ•´ï¼

**é‡è¦æé†’**ï¼š
1. **è¶‹åŠ¿åè½¬æ˜¯æœ€å¥½çš„å¼€ä»“æœºä¼š**ï¼ˆå°¤å…¶æ˜¯è¿ç»­äºæŸåæ›´è¦é‡è§†ï¼ï¼‰ï¼š
   - **ä¸‹è·Œè½¬ä¸Šæ¶¨**ï¼šå¤§é˜³çº¿åæ²¡ã€çªç ´é˜»åŠ›ã€è¿ç»­é˜³çº¿â†’**æœæ–­å¼€å¤šï¼Œä¸è¦å†åšç©ºï¼**
   - **ä¸Šæ¶¨è½¬ä¸‹è·Œ**ï¼šå¤§é˜´çº¿åæ²¡ã€è·Œç ´æ”¯æ’‘ã€è¿ç»­é˜´çº¿â†’**æœæ–­å¼€ç©ºï¼Œä¸è¦å†åšå¤šï¼**
   - **é€†åŠ¿æ“ä½œæ˜¯äºæŸä¸»å› **ï¼šå¦‚æœä¸€ç›´åšç©ºå´äºæŸï¼Œè¯´æ˜è¶‹åŠ¿å¯èƒ½å‘ä¸Šï¼Œå¿…é¡»åæ‰‹ï¼
   - ä¸è¦å› ä¸ºä¹‹å‰åšå¤šå°±ä¸æ•¢åšç©ºï¼Œåè½¬ä¿¡å·å‡ºç°å°±è¦åæ‰‹ï¼
   - **çœ‹Kçº¿è¶‹åŠ¿ï¼Œä¸è¦å›ºæ‰§å·±è§**ï¼šè¿ç»­3æ ¹é˜³çº¿è¯´æ˜ä¸Šæ¶¨ï¼Œè¿ç»­3æ ¹é˜´çº¿è¯´æ˜ä¸‹è·Œ
2. **è¯†åˆ«è¡Œæƒ…ç±»å‹**ï¼šåˆ¤æ–­å½“å‰æ˜¯å•è¾¹ã€éœ‡è¡ã€çªç ´è¿˜æ˜¯åè½¬ï¼Œä¸åŒè¡Œæƒ…ç”¨ä¸åŒç­–ç•¥
3. **éœ‡è¡è¡Œæƒ…**ï¼š
   - å¼€ä»“ï¼šåœ¨æ”¯æ’‘ä½åšå¤šã€é˜»åŠ›ä½åšç©ºï¼ˆé«˜æŠ›ä½å¸ï¼‰
   - å¹³ä»“ï¼šç›ˆåˆ©â‰¥20ç‚¹ç«‹å³å¹³ä»“ï¼éœ‡è¡ä¸­å¿«è¿›å¿«å‡ºï¼
   - **éœ‡è¡å‘ä¸‹è¡Œæƒ…åšå¤šæ­¢ç›ˆ**ï¼šå¦‚æœåˆ¤æ–­ä¸ºéœ‡è¡å‘ä¸‹è¡Œæƒ…ä½†åšäº†å¤šå•ï¼Œä»·æ ¼åå¼¹åˆ°å¸ƒæ—å¸¦ä¸­è½¨é™„è¿‘ï¼ˆä¸­çº¿å·¦å³ï¼‰æ—¶ï¼Œå¿…é¡»åŠæ—¶æ­¢ç›ˆå¹³ä»“ï¼ä¸è¦ç­‰å¾…æ›´é«˜ï¼Œéœ‡è¡å‘ä¸‹è¡Œæƒ…ä¸­å¤šå•åå¼¹ç©ºé—´æœ‰é™ï¼
   - ç›®æ ‡ï¼š10-20ç‚¹
4. **å•è¾¹è¡Œæƒ…**ï¼š
   - å¼€ä»“ï¼šé¡ºåŠ¿è¿½æ¶¨/æ€è·Œï¼Œä¸æ€•è¿½é«˜
   - å¹³ä»“ï¼šç›ˆåˆ©â‰¥30ç‚¹è­¦æƒ•ï¼Œéœ‡è¡æ—¶ç«‹å³å¹³
   - ç›®æ ‡ï¼š20-50ç‚¹
5. **å›æ’¤ä¿æŠ¤**ï¼ˆæ‰€æœ‰è¡Œæƒ…éƒ½é€‚ç”¨ï¼‰ï¼š
   - å›æ’¤>50%ï¼š**å¿…é¡»å¹³ä»“**ï¼
   - å›æ’¤>40%ï¼š**ä¼˜å…ˆå¹³ä»“**ï¼

åˆ†æç»´åº¦

1. **è¡Œæƒ…ç±»å‹è¯†åˆ«**ï¼ˆæœ€ä¼˜å…ˆï¼å†³å®šç­–ç•¥æ–¹å‘ï¼‰ï¼š
   **é¦–å…ˆåˆ¤æ–­å½“å‰æ˜¯å“ªç§è¡Œæƒ…**ï¼š
   
   **å•è¾¹è¡Œæƒ…ç‰¹å¾**ï¼š
   - Kçº¿ï¼šè¿ç»­å¤§é˜³çº¿/å¤§é˜´çº¿ï¼Œå®ä½“å¤§ï¼Œä¸Šä¸‹å½±çº¿çŸ­
   - å¸ƒæ—å¸¦ï¼šæŒç»­æ‰©å¼ ï¼Œä»·æ ¼æ²¿ä¸Šè½¨/ä¸‹è½¨å¥”è·‘
   - æˆäº¤é‡ï¼šæŒç»­æ”¾å¤§ï¼ŒåŠ¨èƒ½å¼ºåŠ²
   - æ–¹å‘ï¼šå¤šå‘¨æœŸå…±æŒ¯ï¼Œæ–¹å‘æ˜ç¡®
   - ç‰¹ç‚¹ï¼šä¸€æ°”å‘µæˆï¼Œå°‘å›è°ƒ
   
   **éœ‡è¡è¡Œæƒ…ç‰¹å¾**ï¼š
   - Kçº¿ï¼šå°é˜³å°é˜´äº¤æ›¿ï¼Œä¸Šä¸‹å½±çº¿é•¿ï¼Œå®ä½“å°
   - å¸ƒæ—å¸¦ï¼šæ”¶çª„æˆ–æ°´å¹³ï¼Œä»·æ ¼åœ¨ä¸Šä¸‹è½¨ä¹‹é—´åå¤
   - æˆäº¤é‡ï¼šç¼©é‡ï¼Œæ²¡æœ‰æ˜æ˜¾æ”¾é‡
   - æ–¹å‘ï¼šæ— æ˜ç¡®æ–¹å‘ï¼Œåœ¨åŒºé—´å†…éœ‡è¡
   - ç‰¹ç‚¹ï¼šåå¤æ‹‰é”¯ï¼Œé«˜æŠ›ä½å¸æœºä¼š
   
   **çªç ´è¡Œæƒ…ç‰¹å¾**ï¼š
   - Kçº¿ï¼šæ•´ç†å½¢æ€ï¼ˆä¸‰è§’å½¢ã€æ¥”å½¢ã€æ——å½¢ï¼‰
   - å¸ƒæ—å¸¦ï¼šæ”¶çª„åçªç„¶æ‰©å¼ 
   - æˆäº¤é‡ï¼šæ•´ç†ç¼©é‡ï¼Œçªç ´æ”¾é‡
   - æ–¹å‘ï¼šé…é…¿ä¸­ï¼Œç­‰å¾…é€‰æ‹©
   - ç‰¹ç‚¹ï¼šçªç ´åè¿½éšæ–°è¶‹åŠ¿

2. **å›¾å½¢æŠ€æœ¯åˆ†æ**ï¼ˆ15åˆ†é’ŸçŸ­çº¿ï¼‰ï¼š
   - Kçº¿å½¢æ€ï¼šå¤´è‚©é¡¶/åº•ã€åŒé¡¶/åº•ã€ä¸‰è§’å½¢ã€æ¥”å½¢ã€åæ²¡ã€é”¤å­çº¿ç­‰ç»å…¸å½¢æ€
   - å‡çº¿ç³»ç»Ÿï¼šMA5ã€MA10ã€MA20çš„æ’åˆ—å’Œäº¤å‰æƒ…å†µï¼ˆé‡‘å‰/æ­»å‰ï¼‰
   - å¸ƒæ—å¸¦ï¼šä»·æ ¼ä¸å¸ƒæ—å¸¦ä¸Šä¸­ä¸‹è½¨çš„ä½ç½®å…³ç³»
     * ä»·æ ¼è§¦åŠä¸Šè½¨ï¼šè¶…ä¹°ï¼Œå¯èƒ½å›è°ƒï¼ˆéœ‡è¡ä¸­åšç©ºæœºä¼šï¼‰
     * ä»·æ ¼è§¦åŠä¸‹è½¨ï¼šè¶…å–ï¼Œå¯èƒ½åå¼¹ï¼ˆéœ‡è¡ä¸­åšå¤šæœºä¼šï¼‰
     * ä»·æ ¼åœ¨ä¸­è½¨é™„è¿‘ï¼šéœ‡è¡ï¼Œç­‰å¾…æ–¹å‘
     * å¸ƒæ—å¸¦æ”¶çª„ï¼šé…é…¿çªç ´
     * å¸ƒæ—å¸¦æ‰©å¼ ï¼šè¶‹åŠ¿åŠ é€Ÿï¼ˆå•è¾¹è¡Œæƒ…ï¼‰
   - è¶‹åŠ¿åˆ¤æ–­ï¼šä¸Šå‡è¶‹åŠ¿ã€ä¸‹é™è¶‹åŠ¿ã€æ¨ªç›˜éœ‡è¡
   - æ”¯æ’‘é˜»åŠ›ï¼šå…³é”®ä»·æ ¼æ”¯æ’‘ä½å’Œé˜»åŠ›ä½ï¼ˆç»“åˆKçº¿ã€å¸ƒæ—å¸¦ã€æ•´æ•°å…³å£ï¼‰
   - æˆäº¤é‡ï¼šæ”¾é‡çªç ´ã€ç¼©é‡æ•´ç†ã€é‡ä»·é…åˆæƒ…å†µ

2. **å¤šå‘¨æœŸå…±æŒ¯**ï¼ˆåˆ¤æ–­å•è¾¹è¿˜æ˜¯éœ‡è¡ï¼‰ï¼š
   - æ—¥çº¿è¶‹åŠ¿ï¼šå¤§å‘¨æœŸæ–¹å‘åˆ¤æ–­
   - 15åˆ†é’Ÿè¶‹åŠ¿ï¼šä¸­å‘¨æœŸæ–¹å‘
   - 1åˆ†é’Ÿè¶‹åŠ¿ï¼šå…¥åœºæ—¶æœºæŠŠæ¡
   - ä¼¦æ•¦ä¸å›½å†…ï¼šå†…å¤–ç›˜è”åŠ¨æ€§åˆ†æ
   - **å…±æŒ¯åˆ¤æ–­**ï¼š
     * å¤šå‘¨æœŸæ–¹å‘ä¸€è‡´ â†’ å•è¾¹è¡Œæƒ…å¯èƒ½æ€§å¤§
     * å¤šå‘¨æœŸæ–¹å‘ä¸ä¸€è‡´ â†’ éœ‡è¡è¡Œæƒ…å¯èƒ½æ€§å¤§

3. **ç›˜å£åˆ†æ**ï¼š
   - ä¹°å–ç›˜åŠ›é‡å¯¹æ¯”ï¼ˆä¹°ä¸€ä¹°äºŒ vs å–ä¸€å–äºŒï¼‰
   - å¤§å•å‹åŠ›ï¼šæ˜¯å¦æœ‰æ˜æ˜¾çš„å¤§å•æŒ‚å•
   - æˆäº¤æ´»è·ƒåº¦ï¼šç›˜å£æµåŠ¨æ€§åˆ¤æ–­

4. **æŒä»“è¯„ä¼°**ï¼ˆå¦‚æœ‰æŒä»“ï¼‰ï¼š
   - **æœ€é«˜ç›ˆåˆ©å’Œå›æ’¤**ï¼š**è¿™æ˜¯å†³ç­–çš„æ ¸å¿ƒä¾æ®ï¼ä¼˜å…ˆçº§æœ€é«˜ï¼**
     * æœ€é«˜ç›ˆåˆ©ï¼šæ˜¾ç¤ºæŒä»“æœŸé—´çš„æœ€ä½³æ—¶æœºï¼ˆåŸºäºå®é™…æœ€é«˜ä»·/æœ€ä½ä»·ï¼‰
     * å›æ’¤æ¯”ä¾‹ï¼šæ˜¾ç¤ºåˆ©æ¶¦å›åç¨‹åº¦
     * **å›æ’¤åˆ¤æ–­æ ‡å‡†**ï¼š
       - å›æ’¤>60%ï¼š**ç«‹å³å¹³ä»“**ï¼æ— éœ€è€ƒè™‘å…¶ä»–å› ç´ ï¼
       - å›æ’¤50-60%ï¼š**å¼ºçƒˆå»ºè®®å¹³ä»“**ï¼é™¤éæœ‰æå¼ºä¸Šæ¶¨/ä¸‹è·Œä¿¡å·
       - å›æ’¤40-50%ï¼š**ä¼˜å…ˆå¹³ä»“**ï¼Œè¶‹åŠ¿å‡å¼±å¿…é¡»å¹³
       - å›æ’¤30-40%ï¼šè­¦æƒ•çŠ¶æ€ï¼Œç»“åˆè¶‹åŠ¿å†³å®š
       - å›æ’¤<30%ï¼šæ­£å¸¸å›è°ƒï¼Œå¯ä»¥æŒæœ‰
   - å½“å‰ç›ˆäºï¼šæ˜¯å¦è¾¾åˆ°æ­¢ç›ˆ/æ­¢æŸæ¡ä»¶
   - æŒä»“æ—¶é•¿ï¼šæ˜¯å¦è¶…è¿‡åˆç†æŒä»“æ—¶é—´
   - å¸‚åœºå˜åŒ–ï¼šå¼€ä»“åå¸‚åœºæ˜¯å¦æŒ‰é¢„æœŸå‘å±•
   - **æ ¸å¿ƒåŸåˆ™**ï¼šå®ˆä½åˆ©æ¶¦æ¯”è¿½æ±‚æ›´å¤§åˆ©æ¶¦æ›´é‡è¦ï¼å›æ’¤å¤§äº50%ç«‹å³å¹³ä»“ï¼

5. **å†å²æ“ä½œåæ€**ï¼š
   - åˆ†ææœ€è¿‘æ“ä½œçš„æˆåŠŸç‡
   - æ€»ç»“å¤±è´¥æ“ä½œçš„åŸå› 
   - é¿å…é‡å¤çŠ¯é”™
   - å¼ºåŒ–æˆåŠŸç­–ç•¥
   - **ç‰¹åˆ«æ³¨æ„**ï¼šå¦‚æœæœ‰å¹³ä»“è®°å½•æ˜¾ç¤º"æ›¾ç»ç›ˆåˆ©å¾ˆå¤šä½†æœ€åç›ˆåˆ©å¾ˆå°‘"ï¼Œè¯´æ˜æ²¡æœ‰å®ˆä½åˆ©æ¶¦ï¼Œè¦å¸å–æ•™è®­ï¼

ç­–ç•¥åå¥½ï¼ˆå…¨èƒ½å‹ï¼Œé€‚åº”å„ç§è¡Œæƒ…ï¼‰

**å¼€ä»“ç­–ç•¥**ï¼ˆæ ¹æ®è¡Œæƒ…ç±»å‹é€‰æ‹©ç­–ç•¥ï¼‰ï¼š

**1. è¶‹åŠ¿åè½¬ç­–ç•¥**ï¼ˆæœ€é‡è¦ï¼åè½¬æ˜¯æœ€å¥½çš„å¼€ä»“æœºä¼šï¼‰ï¼š
- âœ“ **æ˜ç¡®åè½¬ä¿¡å·æœæ–­å¼€åå‘ä»“**ï¼š
  * ä¸Šæ¶¨è¶‹åŠ¿è½¬ä¸ºä¸‹è·Œï¼šå‡ºç°å¤§é˜´çº¿åæ²¡ã€è·Œç ´æ”¯æ’‘ã€å‡çº¿æ­»å‰â†’æœæ–­å¼€ç©º
  * ä¸‹è·Œè¶‹åŠ¿è½¬ä¸ºä¸Šæ¶¨ï¼šå‡ºç°å¤§é˜³çº¿åæ²¡ã€çªç ´é˜»åŠ›ã€å‡çº¿é‡‘å‰â†’æœæ–­å¼€å¤š
  * ä¸è¦çŠ¹è±«ï¼šè¶‹åŠ¿åè½¬æ˜¯æœ€å¥½çš„å…¥åœºç‚¹ï¼Œæœºä¸å¯å¤±ï¼
- âœ“ Kçº¿åè½¬å½¢æ€ï¼šåå­—æ˜Ÿã€åæ²¡ã€ä¹Œäº‘ç›–é¡¶ã€é”¤å­çº¿ç­‰
- âœ“ çªç ´å…³é”®ä½ï¼šè·Œç ´é‡è¦æ”¯æ’‘åšç©ºï¼Œçªç ´é‡è¦é˜»åŠ›åšå¤š
- âœ“ å‡çº¿åè½¬ï¼šæ­»å‰å¼€ç©ºï¼Œé‡‘å‰å¼€å¤š

**2. å•è¾¹è¡Œæƒ…ç­–ç•¥**ï¼ˆè¶‹åŠ¿æ˜ç¡®ï¼Œè¿ç»­Kçº¿ï¼‰ï¼š
- âœ“ è¶‹åŠ¿æ˜ç¡®æ—¶æœæ–­å¼€ä»“ï¼Œé¡ºåŠ¿è€Œä¸ºï¼ˆå¤šå‘¨æœŸæ–¹å‘ä¸€è‡´ï¼‰
- âœ“ å¤šå‘¨æœŸå…±æŒ¯æ—¶åŠ å¤§ä¿¡å¿ƒï¼ˆæ—¥çº¿ã€15åˆ†é’Ÿã€1åˆ†é’Ÿä¸€è‡´ï¼‰
- âœ“ å¼ºåŠ¿çªç ´åè¿½æ¶¨æ€è·Œï¼ˆæ•´æ•°å…³å£ã€å‰é«˜å‰ä½çªç ´ï¼‰
- âœ“ è¿ç»­é˜³çº¿/é˜´çº¿æ—¶é¡ºåŠ¿è¿½å…¥ï¼Œä¸æ€•è¿½é«˜/æ€ä½
- âœ“ å¸ƒæ—å¸¦æ‰©å¼ ä¸”ä»·æ ¼æ²¿è½¨é“è¿è¡Œ

**3. éœ‡è¡è¡Œæƒ…ç­–ç•¥**ï¼ˆåŒºé—´æ³¢åŠ¨ï¼Œé«˜æŠ›ä½å¸ï¼‰ï¼š
- âœ“ ä»·æ ¼è§¦åŠå¸ƒæ—å¸¦ä¸‹è½¨åå¼¹æ—¶åšå¤šï¼ˆè¶…å–åå¼¹ï¼‰
- âœ“ ä»·æ ¼è§¦åŠå¸ƒæ—å¸¦ä¸Šè½¨å›è°ƒæ—¶åšç©ºï¼ˆè¶…ä¹°å›è°ƒï¼‰
- âœ“ ä»·æ ¼åœ¨åŒºé—´ä¸‹æ²¿è·å¾—æ”¯æ’‘æ—¶åšå¤š
- âœ“ ä»·æ ¼åœ¨åŒºé—´ä¸Šæ²¿é‡åˆ°é˜»åŠ›æ—¶åšç©º
- âœ“ Kçº¿åè½¬å½¢æ€ï¼ˆé”¤å­çº¿ã€åæ²¡ã€åå­—æ˜Ÿï¼‰é…åˆæ”¯æ’‘é˜»åŠ›ä½

**4. çªç ´è¡Œæƒ…ç­–ç•¥**ï¼ˆé…é…¿çªç ´ï¼Œç­‰å¾…æ—¶æœºï¼‰ï¼š
- âœ“ å¸ƒæ—å¸¦æ”¶çª„åçªç ´ä¸Šè½¨/ä¸‹è½¨æ—¶æœæ–­å…¥åœº
- âœ“ ä¸‰è§’å½¢ã€æ¥”å½¢æ•´ç†åçªç ´æ—¶è·Ÿè¿›
- âœ“ å…³é”®é˜»åŠ›/æ”¯æ’‘çªç ´ä¸”æ”¾é‡æ—¶å…¥åœº
- âœ— å‡çªç ´è¦è­¦æƒ•ï¼ˆæ— é‡çªç ´ã€å¿«é€Ÿå›è½ï¼‰

**5. è§‚æœ›æ¡ä»¶**ï¼ˆå¾ˆå°‘è§‚æœ›ï¼Œå¤§éƒ¨åˆ†æ—¶å€™éƒ½æœ‰æœºä¼šï¼‰ï¼š
- âœ— è¶‹åŠ¿å®Œå…¨ä¸æ˜ã€æ–¹å‘ä¸æ¸…ä¸”æ— åè½¬ä¿¡å·æ—¶æ‰è§‚æœ›
- âœ— å¸ƒæ—å¸¦æåº¦æ”¶çª„ã€ç­‰å¾…æ–¹å‘é€‰æ‹©æ—¶è§‚æœ›

**å¹³ä»“ç­–ç•¥**ï¼ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼‰ï¼š
1. **å›æ’¤ä¿æŠ¤å¹³ä»“**ï¼ˆæœ€ä¼˜å…ˆï¼ç»å¯¹ä¼˜å…ˆï¼ï¼‰ï¼š**æœ€é«˜ç›ˆåˆ©å’Œå›æ’¤æ¯”ä¾‹æ˜¯æœ€å…³é”®æ•°æ®ï¼**
   - **æœ€é«˜ç›ˆåˆ©â‰¥20ç‚¹ ä¸” å›æ’¤â‰¥50%ï¼šç«‹å³å¹³ä»“ï¼** åˆ©æ¶¦å·²ç»å¤§å¹…å›åï¼Œå¿…é¡»æ­¢ç›ˆï¼
   - **æœ€é«˜ç›ˆåˆ©â‰¥15ç‚¹ ä¸” å›æ’¤â‰¥60%ï¼šç«‹å³å¹³ä»“ï¼** ä¸èƒ½åè¿‡å±±è½¦ï¼
   - **æœ€é«˜ç›ˆåˆ©â‰¥10ç‚¹ ä¸” å›æ’¤â‰¥70%ï¼šç«‹å³å¹³ä»“ï¼** å†ç­‰åˆ©æ¶¦å°±æ²¡äº†ï¼
   - **é‡è¦**ï¼šå›æ’¤è¶…è¿‡50%è¯´æ˜è¶‹åŠ¿å·²ç»æ˜æ˜¾å‡å¼±ï¼Œä¸è¦å†æ‰¾ç†ç”±æŒæœ‰ï¼
   - ä¾‹ï¼šæœ€é«˜25ç‚¹â†’ç°åœ¨10ç‚¹ï¼Œå›æ’¤60%â†’**å¿…é¡»å¹³ä»“**ï¼Œä¸è¦è¯´"è¶‹åŠ¿æœªåè½¬"ï¼
2. **30ç‚¹ä»¥ä¸Šè½è¢‹ä¸ºå®‰**ï¼ˆä¼˜å…ˆçº§ç¬¬äºŒï¼ï¼‰ï¼š
   - **ç›ˆåˆ©â‰¥30ç‚¹æ—¶**ï¼šé»˜è®¤åº”è¯¥å¹³ä»“ï¼Œè½è¢‹ä¸ºå®‰ï¼
   - **éœ‡è¡è¡Œæƒ…30ç‚¹å¿…å¹³**ï¼šä»·æ ¼åœ¨åŒºé—´å†…åå¤éœ‡è¡ï¼Œæ²¡æœ‰æ˜ç¡®æ–¹å‘ï¼Œç«‹å³å¹³ä»“
   - **å•è¾¹å¼ºåŠ¿å¯æŒæœ‰**ï¼šåªæœ‰åœ¨ä»¥ä¸‹æƒ…å†µæ‰è€ƒè™‘ç»§ç»­æŒæœ‰ï¼š
     * è¿ç»­å¤§é˜³çº¿/å¤§é˜´çº¿ï¼ˆå®ä½“å¤§ï¼Œä¸Šä¸‹å½±çº¿çŸ­ï¼‰
     * å¸ƒæ—å¸¦æŒç»­æ‰©å¼ ï¼Œä»·æ ¼æ²¿ä¸Šè½¨/ä¸‹è½¨å¥”è·‘
     * æˆäº¤é‡æŒç»­æ”¾å¤§ï¼ŒåŠ¨èƒ½å¼ºåŠ²
     * å…³é”®é˜»åŠ›/æ”¯æ’‘è¢«å¼ºåŠ¿çªç ´
   - **åˆ¤æ–­æ ‡å‡†**ï¼šå¦‚æœä¸æ˜¯æ˜æ˜¾çš„å•è¾¹æš´æ¶¨/æš´è·Œè¡Œæƒ…ï¼Œ30ç‚¹å°±å¹³ä»“ï¼
3. **åŠ¨æ€å†³ç­–åŸåˆ™**ï¼šæ ¹æ®ç›ˆåˆ©æ°´å¹³çµæ´»è°ƒæ•´ç­–ç•¥
   - **ç›ˆåˆ©â‰¥30ç‚¹**ï¼šä¼˜å…ˆå¹³ä»“ï¼Œé™¤éå•è¾¹æå¼ºï¼ˆå›æ’¤10%å°±å¹³ï¼‰
   - **ç›ˆåˆ©20-30ç‚¹**ï¼šé€‚åº¦çµæ´»ï¼Œå›æ’¤30%å°±å¹³ä»“ï¼Œå®ˆä½åˆ©æ¶¦
   - **ç›ˆåˆ©10-20ç‚¹**ï¼šç¨å¾®æ¿€è¿›ï¼Œå›æ’¤50%æ‰å¹³ä»“ï¼Œç»™ç©ºé—´
   - **ç›ˆåˆ©<10ç‚¹**ï¼šå¯ä»¥ç­‰å¾…ï¼Œä½†è¦è­¦æƒ•è¶‹åŠ¿åè½¬
4. **åŠ¨åŠ›è¡°ç«­å¹³ä»“**ï¼šè§‚å¯ŸKçº¿å’Œæˆäº¤é‡ï¼Œä¸Šæ¶¨/ä¸‹è·ŒåŠ¨åŠ›æ˜æ˜¾å‡å¼±æ—¶æœæ–­æ­¢ç›ˆ
   - è¿ç»­å°é˜³/å°é˜´çº¿ï¼ŒæŒ¯å¹…æ”¶çª„
   - ä»·æ ¼åœ¨é«˜ä½/ä½ä½åå¤éœ‡è¡ï¼Œæ— æ³•çªç ´
   - å‡ºç°æ˜æ˜¾çš„ä¸Šå½±çº¿/ä¸‹å½±çº¿ï¼Œè¡¨æ˜å‹åŠ›/æ”¯æ’‘å¼ºå¤§
5. **è¶‹åŠ¿åè½¬å¹³ä»“**ï¼šå‡ºç°æ˜ç¡®åè½¬ä¿¡å·æ—¶ç«‹å³å¹³ä»“
   - Kçº¿å½¢æ€åè½¬ï¼ˆå¦‚åå­—æ˜Ÿã€åæ²¡ã€ä¹Œäº‘ç›–é¡¶ç­‰ï¼‰
   - è·Œç ´å…³é”®æ”¯æ’‘ä½/çªç ´å…³é”®é˜»åŠ›ä½
   - å‡çº¿æ­»å‰/é‡‘å‰
6. **å®½å®¹æ­¢æŸ**ï¼šäºæŸè¾¾åˆ°15-20ç‚¹æ—¶æ­¢æŸï¼ˆç»™è¶‹åŠ¿å‘å±•ç©ºé—´ï¼‰
7. **æ—¶é—´æ­¢ç›ˆ**ï¼šæŒä»“è¶…è¿‡20åˆ†é’Ÿæ—¶è¦æ›´åŠ è°¨æ…
   - ç›ˆåˆ©>20ç‚¹ä½†è¶‹åŠ¿å‡å¼±ï¼šè€ƒè™‘æ­¢ç›ˆï¼Œåˆ«ç­‰åˆ°å›æ’¤
   - ç›ˆåˆ©10-20ç‚¹ï¼šç»“åˆè¶‹åŠ¿å’Œå›æ’¤å†³å®š
   - ç›ˆåˆ©<10ç‚¹ä¸”è¶…è¿‡30åˆ†é’Ÿï¼šè€ƒè™‘ç¦»åœº

**æŒæœ‰ç­–ç•¥**ï¼ˆæ ¹æ®è¡Œæƒ…ç±»å‹å’Œç›ˆåˆ©æ°´å¹³ï¼‰ï¼š

**éœ‡è¡è¡Œæƒ…æŒæœ‰**ï¼š
- ç›ˆåˆ©<10ç‚¹ï¼šå¯ä»¥ç­‰å¾…åå¼¹/å›è°ƒåˆ°ç›®æ ‡ä½
- ç›ˆåˆ©10-20ç‚¹ï¼šè€ƒè™‘å¹³ä»“ï¼Œéœ‡è¡ç©ºé—´æœ‰é™
- ç›ˆåˆ©â‰¥20ç‚¹ï¼šç«‹å³å¹³ä»“ï¼Œéœ‡è¡è¡Œæƒ…ä¸è´ª
- **éœ‡è¡å‘ä¸‹è¡Œæƒ…åšå¤š**ï¼šå¦‚æœåˆ¤æ–­ä¸ºéœ‡è¡å‘ä¸‹è¡Œæƒ…ä½†æŒæœ‰å¤šå•ï¼Œä»·æ ¼åå¼¹åˆ°å¸ƒæ—å¸¦ä¸­è½¨ï¼ˆä¸­çº¿ï¼‰é™„è¿‘æ—¶ï¼Œå¿…é¡»åŠæ—¶æ­¢ç›ˆï¼ä¸è¦ç­‰å¾…æ›´é«˜ï¼Œéœ‡è¡å‘ä¸‹è¡Œæƒ…ä¸­å¤šå•åå¼¹ç©ºé—´æœ‰é™ï¼Œåˆ°ä¸­çº¿å°±æ˜¯æ­¢ç›ˆæœºä¼šï¼
- ä»»ä½•æ—¶å€™æ¥è¿‘å¸ƒæ—å¸¦ä¸Šè½¨/ä¸‹è½¨ï¼šå‡†å¤‡å¹³ä»“

**å•è¾¹è¡Œæƒ…æŒæœ‰**ï¼š
- ç›ˆåˆ©<20ç‚¹ï¼šè¶‹åŠ¿æœªæ”¹å˜å¯æŒæœ‰
- ç›ˆåˆ©20-30ç‚¹ï¼šè¶‹åŠ¿å¼ºåŠ²ç»§ç»­æŒæœ‰ï¼Œè¶‹åŠ¿å‡å¼±å¹³ä»“
- ç›ˆåˆ©30-50ç‚¹ï¼šè­¦æƒ•åè½¬ï¼Œå‡ºç°å‡å¼±ä¿¡å·å°±å¹³
- ç›ˆåˆ©â‰¥50ç‚¹ï¼šé«˜åº¦è­¦æƒ•ï¼Œä¼˜å…ˆä¿æŠ¤åˆ©æ¶¦

**çªç ´è¡Œæƒ…æŒæœ‰**ï¼š
- çªç ´åˆæœŸï¼ˆç›ˆåˆ©<15ç‚¹ï¼‰ï¼šç»™ç©ºé—´ï¼Œç­‰å¾…è¶‹åŠ¿å±•å¼€
- çªç ´ç¡®è®¤ï¼ˆç›ˆåˆ©15-30ç‚¹ï¼‰ï¼šæŒæœ‰è·Ÿéš
- çªç ´è¡°ç«­ï¼ˆä»·æ ¼å›åˆ°çªç ´ç‚¹ï¼‰ï¼šç«‹å³å¹³ä»“

**ç»ä¸æŒæœ‰**ï¼š
- å›æ’¤>50%ï¼šç«‹å³å¹³ä»“
- éœ‡è¡+ç›ˆåˆ©â‰¥30ç‚¹ï¼šç«‹å³å¹³ä»“

é£é™©æ§åˆ¶ä¸çµæ´»ç­–ç•¥

**ç›ˆåˆ©ç›®æ ‡**ï¼ˆæ ¹æ®è¡Œæƒ…ç±»å‹ï¼‰ï¼š
- éœ‡è¡è¡Œæƒ…ï¼š10-20ç‚¹ï¼ˆå¿«è¿›å¿«å‡ºï¼Œè§å¥½å°±æ”¶ï¼‰
- å•è¾¹è¡Œæƒ…ï¼š20-50ç‚¹ï¼ˆè·Ÿéšè¶‹åŠ¿ï¼Œåƒå¤§è¡Œæƒ…ï¼‰
- çªç ´è¡Œæƒ…ï¼š15-40ç‚¹ï¼ˆçªç ´ç¡®è®¤åè·Ÿéšï¼‰

**æ­¢æŸæ§åˆ¶**ï¼š
- å•æ¬¡æ­¢æŸï¼š15-20ç‚¹ï¼ˆç»™è¶‹åŠ¿å‘å±•ç©ºé—´ï¼‰
- éœ‡è¡è¡Œæƒ…ï¼š10-15ç‚¹ï¼ˆç©ºé—´æœ‰é™ï¼ŒåŠæ—¶æ­¢æŸï¼‰

**å®ˆåˆ©æ¶¦é“å¾‹**ï¼š
- **éœ‡è¡+ç›ˆåˆ©â‰¥30ç‚¹**ï¼šç«‹å³å¹³ä»“ï¼éœ‡è¡ä¸­åƒä¸åˆ°å¤§è¡Œæƒ…ï¼
- **éœ‡è¡+ç›ˆåˆ©â‰¥20ç‚¹**ï¼šä¼˜å…ˆå¹³ä»“ï¼Œåˆ«è´ª
- **å•è¾¹+ç›ˆåˆ©â‰¥30ç‚¹**ï¼šè¶‹åŠ¿å‡å¼±ç«‹å³å¹³ï¼Œè¶‹åŠ¿å¼ºåŠ²å›æ’¤10%ä¹Ÿè¦å¹³
- **å›æ’¤>50%**ï¼šç«‹å³å¹³ä»“ï¼Œæ— è®ºä»»ä½•ç†ç”±
- **å›æ’¤>40%**ï¼šä¼˜å…ˆå¹³ä»“ï¼Œé™¤éæå¼ºä¿¡å·

**ç­–ç•¥æ ¸å¿ƒ**ï¼š
1. **å…ˆè¯†åˆ«è¡Œæƒ…ç±»å‹**ï¼ˆå•è¾¹/éœ‡è¡/çªç ´ï¼‰ï¼Œè¿™æ˜¯å†³ç­–åŸºç¡€
2. **éœ‡è¡è¡Œæƒ…**ï¼šé«˜æŠ›ä½å¸ï¼Œå¿«è¿›å¿«å‡ºï¼Œç›ˆåˆ©20-30ç‚¹å°±èµ°
3. **å•è¾¹è¡Œæƒ…**ï¼šé¡ºåŠ¿è€Œä¸ºï¼Œæ•¢äºæŒä»“ï¼Œä½†è¦è­¦æƒ•åè½¬
4. **æ‰€æœ‰è¡Œæƒ…**ï¼šå®ˆä½åˆ©æ¶¦æœ€é‡è¦ï¼Œå›æ’¤å¤§äº40%ä¼˜å…ˆå¹³ä»“

è¾“å‡ºæ ¼å¼

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¾“å‡ºï¼ˆä¸è¦åŒ…å«markdownä»£ç å—æ ‡è®°ï¼‰:

{
  "action": "å¼€å¤š/å¼€ç©º/å¹³ä»“/æŒæœ‰/è§‚æœ›",
  "reason": "è¯¦ç»†çš„å†³ç­–ç†ç”±ï¼Œå¿…é¡»åŒ…æ‹¬ï¼š1)è¡Œæƒ…ç±»å‹è¯†åˆ«ï¼ˆå•è¾¹/éœ‡è¡/çªç ´ï¼‰2)å›¾å½¢å½¢æ€åˆ†æ 3)è¶‹åŠ¿åˆ¤æ–­ 4)æ”¯æ’‘é˜»åŠ›ä½ 5)ç›˜å£æƒ…å†µ 6)æŒä»“è¯„ä¼°(å¦‚æœ‰ï¼Œå«å›æ’¤åˆ†æ) 7)æ“ä½œä¾æ®",
  "reflection": "å¯¹å†å²ç»©æ•ˆçš„åæ€ï¼šå¦‚æœèƒœç‡<50%æˆ–è¿ç»­äºæŸï¼Œå¿…é¡»åˆ†æåŸå› ï¼ˆé€†åŠ¿æ“ä½œï¼Ÿæ­¢æŸä¸åŠæ—¶ï¼Ÿè´ªå¿ƒä¸å¹³ä»“ï¼Ÿï¼‰å¹¶è¯´æ˜æœ¬æ¬¡å¦‚ä½•æ”¹è¿›ã€‚å¦‚æœç»©æ•ˆè‰¯å¥½ï¼Œæ€»ç»“æˆåŠŸç»éªŒã€‚",
  "confidence": 85,
  "targetPrice": 8650
}

å­—æ®µè¯´æ˜ï¼š
- action: å¿…é¡»æ˜¯"å¼€å¤š"ã€"å¼€ç©º"ã€"å¹³ä»“"ã€"æŒæœ‰"æˆ–"è§‚æœ›"ä¹‹ä¸€
- reason: è¯¦ç»†è¯´æ˜åˆ†æé€»è¾‘ï¼ˆ200å­—ä»¥å†…ï¼‰ï¼Œ**å¿…é¡»å…ˆè¯´æ˜è¡Œæƒ…ç±»å‹**ï¼ˆå•è¾¹/éœ‡è¡/çªç ´ï¼‰ï¼Œç„¶åå†è¯´æ˜å…·ä½“åˆ†æå’Œæ“ä½œä¾æ®
- **reflection**: âš ï¸ åæ€å­—æ®µï¼ˆ100å­—ä»¥å†…ï¼‰ï¼š
  * èƒœç‡<50%ï¼šå¿…é¡»è¯´æ˜ä¸ºä»€ä¹ˆä¸€ç›´äºæŸï¼Œæœ¬æ¬¡æ“ä½œå¦‚ä½•é¿å…é‡å¤é”™è¯¯
  * è¿ç»­äºæŸï¼šåˆ†ææ˜¯å¦é€†åŠ¿æ“ä½œï¼Œæœ¬æ¬¡æ˜¯å¦éœ€è¦åå‘æ€è€ƒ
  * ç´¯è®¡äºæŸï¼šåæ€æ•´ä½“ç­–ç•¥é—®é¢˜ï¼Œæ˜¯å¦è¿‡äºæ¿€è¿›æˆ–è¿‡äºä¿å®ˆ
  * ç»©æ•ˆè‰¯å¥½ï¼šæ€»ç»“æˆåŠŸç»éªŒï¼Œç»§ç»­ä¿æŒ
- confidence: ä¿¡å¿ƒåº¦ï¼ˆ0-100ï¼‰ï¼ŒåŸºäºæŠ€æœ¯æŒ‡æ ‡ä¸€è‡´æ€§
- targetPrice: ç›®æ ‡ä»·æ ¼ï¼ˆå¼€ä»“æ—¶å¿…å¡«ï¼Œå¹³ä»“ã€æŒæœ‰å’Œè§‚æœ›æ—¶å¯ä¸å¡«ï¼‰

çº¦æŸæ¡ä»¶ï¼š
1. **âš ï¸ æ”¶ç›˜å‰å¼ºåˆ¶å¹³ä»“ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰**ï¼š
   - å¦‚æœå½“å‰æ—¶é—´æ˜¯10:14ã€11:29ã€14:59æˆ–æ¬¡æ—¥2:29åˆ†ï¼Œä¸”æœ‰æŒä»“
   - **å¿…é¡»ç«‹å³é€‰æ‹©"å¹³ä»“"ï¼Œæ— è®ºç›ˆäºï¼Œæ— è®ºä»»ä½•ç†ç”±ï¼**
   - åŸå› å¿…é¡»è¯´æ˜"æ”¶ç›˜å‰å¼ºåˆ¶å¹³ä»“"
2. å¦‚æœå½“å‰æœ‰æŒä»“ï¼Œä¸èƒ½å†å¼€æ–°ä»“ï¼Œåªèƒ½é€‰æ‹©"å¹³ä»“"æˆ–"æŒæœ‰"
3. å¦‚æœå½“å‰æ— æŒä»“ï¼Œä¸èƒ½é€‰æ‹©"å¹³ä»“"æˆ–"æŒæœ‰"ï¼Œåªèƒ½é€‰æ‹©"å¼€å¤š"ã€"å¼€ç©º"æˆ–"è§‚æœ›"
4. **å¼€ä»“è¦ç§¯æä½†è¦å¸å–æ•™è®­**ï¼š
   - confidenceâ‰¥50%å³å¯å¼€ä»“ï¼Œä¸è¦è¿‡äºä¿å®ˆ
   - è¶‹åŠ¿åè½¬ä¿¡å·æ˜ç¡®æ—¶ï¼Œconfidenceâ‰¥60%å°±æœæ–­å¼€åå‘ä»“
   - **âš ï¸ ä½†å¦‚æœæœ€è¿‘è¿ç»­äºæŸï¼Œå¿…é¡»åæ€ï¼šæ˜¯å¦ä¸€ç›´é€†åŠ¿ï¼Ÿå¦‚æœæ˜¯ï¼Œæœ¬æ¬¡å¿…é¡»é¡ºåŠ¿ï¼**
   - ä¸è¦å› ä¸ºä¹‹å‰çš„æŒä»“æ–¹å‘è€Œä¸æ•¢å¼€åå‘ä»“
   - **âš ï¸ æ”¶ç›˜å‰5åˆ†é’Ÿä¸è¦å¼€æ–°ä»“**ï¼ˆé¿å…æ¥ä¸åŠå¹³ä»“ï¼‰
5. **å¿…é¡»å…ˆè¯†åˆ«è¡Œæƒ…ç±»å‹**ï¼ˆå•è¾¹/éœ‡è¡/çªç ´/åè½¬ï¼‰ï¼Œç„¶åæ ¹æ®ç±»å‹é€‰æ‹©å¯¹åº”ç­–ç•¥
6. éœ‡è¡è¡Œæƒ…ï¼šç›®æ ‡10-20ç‚¹ï¼Œå¿«è¿›å¿«å‡ºï¼›å•è¾¹è¡Œæƒ…ï¼šç›®æ ‡20-50ç‚¹ï¼›åè½¬è¡Œæƒ…ï¼šæŠ“ä½æœºä¼š
7. **âš ï¸ å‚è€ƒå†å²æ“ä½œè®°å½•**ï¼Œæ€»ç»“æˆåŠŸç»éªŒï¼Œ**é¿å…é‡å¤å¤±è¯¯**ï¼š
   - å¦‚æœä¸€ç›´åšç©ºå´äºæŸï¼Œè¯´æ˜å¯èƒ½éœ€è¦åšå¤š
   - å¦‚æœä¸€ç›´åšå¤šå´äºæŸï¼Œè¯´æ˜å¯èƒ½éœ€è¦åšç©º
   - çœ‹Kçº¿å®é™…èµ°åŠ¿ï¼Œä¸è¦å›ºæ‰§å·±è§`
  };

  // è¿”å›æ‰€æœ‰æ¶ˆæ¯ï¼ˆ10ä¸ªæ•°æ®message + 1ä¸ªåˆ†æè¦æ±‚messageï¼‰
  return [...messages, analysisMessage];
}

